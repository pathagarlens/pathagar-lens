<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pathagar Len's - Smart Book Discovery</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
body{background:#f4f7fb;color:#222}

/* HEADER */
header{
background:#0a2540;color:white;padding:15px 40px;
display:flex;justify-content:space-between;align-items:center;
position:sticky;top:0;z-index:1000;
}

.logo-container{display:flex;align-items:center;}
.logo-img{width:34px;height:34px;margin-right:10px;}
.logo{font-size:22px;font-weight:600;text-decoration:none;color:white;}

.menu-wrapper{display:flex;align-items:center;cursor:pointer;font-size:15px;position:relative;}
.menu-wrapper span{margin-left:6px;}
.menu-icon{font-size:22px;}

.dropdown{
position:absolute;right:0;top:45px;background:white;width:220px;
box-shadow:0 8px 20px rgba(0,0,0,0.15);border-radius:8px;
display:none;flex-direction:column;overflow:hidden;
}
.dropdown a{padding:12px 18px;text-decoration:none;color:#0a2540;font-size:14px;}
.dropdown a:hover{background:#f1f4f8}

/* CONTENT */
.section{
background:#fff;padding:30px 20px;margin:20px auto;
border-radius:8px;max-width:1100px;text-align:center;
box-shadow:0 6px 18px rgba(0,0,0,0.05)
}
.filters{
display:flex;flex-wrap:wrap;gap:12px;
justify-content:center;align-items:center
}
.filters select,.filters input{
min-width:200px;padding:10px;
border-radius:8px;border:1px solid #ddd
}
.filters button{
padding:10px 18px;background:#0a2540;
color:#fff;border:none;border-radius:8px;cursor:pointer
}
.results{
max-width:1100px;margin:20px auto;
display:flex;flex-wrap:wrap;gap:18px;
justify-content:center;padding:20px
}
.book-card{
width:260px;background:#fff;padding:16px;
border-radius:10px;box-shadow:0 10px 24px rgba(13,38,63,0.06);
text-align:left
}
.book-card img{display:block;margin:10px 0;border-radius:6px}
.meta{font-size:13px;color:#555;margin:5px 0}
.source-label{
font-size:12px;font-weight:600;
color:#0a2540;margin-bottom:5px
}
#loadMoreContainer{text-align:center;margin:20px}

footer{
background:#0a2540;color:white;padding:40px 20px;margin-top:60px;
}
.footer-container{
display:flex;justify-content:space-between;flex-wrap:wrap;
max-width:1100px;margin:auto;
}
.footer-section{margin:15px 0;}
.footer-section h4{margin-bottom:12px;font-weight:600;}
.footer-section a{
display:block;color:white;text-decoration:none;
font-size:14px;margin-bottom:6px;
}
.footer-bottom{
text-align:center;margin-top:25px;font-size:14px;
border-top:1px solid rgba(255,255,255,0.2);padding-top:15px;
}
.footer-extra{
text-align:center;font-size:13px;margin-top:10px;opacity:0.85;
}
@media(max-width:768px){
.filters select,.filters input{min-width:140px}
.book-card{width:100%}
}
</style>
</head>

<body>

<header>
<div class="logo-container">
<img src="mainlogo.jpg" class="logo-img">
<a href="index.html" class="logo">Pathagar Len's</a>
</div>

<div class="menu-wrapper" id="menuToggle">
<div class="menu-icon">⋮</div>
<span>Menu</span>
<div class="dropdown" id="menu">
<a href="index.html">Home</a>
<a href="fact.html">Fact Check</a>
<a href="books.html">Books</a>
<a href="research.html">Research</a>
</div>
</div>
</header>

<section class="section">
<h2>Advanced Search</h2>
<div class="filters">
<select id="advSubject"></select>
<input type="text" id="advCustomSubject" placeholder="Custom subject (optional)">
<button id="advSearchBtn">Search</button>
</div>
</section>

<section class="section">
<h2>Browse by Mood or Category</h2>
<div class="filters">
<select id="moodSelect"></select>
<input type="text" id="moodCustom" placeholder="Custom mood or keyword">
<button id="moodSearchBtn">Search</button>
</div>
</section>

<section id="results" class="results"></section>
<div id="loadMoreContainer"></div>

<footer>
<div class="footer-bottom">
© <span id="yearNow"></span> Pathagar Len's Fully Digital Library
</div>
</footer>

<script>

/* MENU */
const menuToggle=document.getElementById("menuToggle");
const menu=document.getElementById("menu");
menuToggle.addEventListener("click",e=>{
e.stopPropagation();
menu.style.display=menu.style.display==="flex"?"none":"flex";
});
document.addEventListener("click",()=>menu.style.display="none");
menu.addEventListener("click",e=>e.stopPropagation());

document.getElementById("yearNow").textContent=new Date().getFullYear();

/* MULTI SOURCE SEARCH */

const API_KEY="AIzaSyBB-hOmNx-ImPOpxTuOl-TPlkwUPOA_Jhw";
const RESULTS_PER_PAGE=20;
let startIndex=0;
let currentQuery="";

const subjects=[
"All Subjects","Sociology","Psychology","Philosophy",
"History","Economics","Education","Computer Science",
"Artificial Intelligence","Mathematics","Physics",
"Chemistry","Biology","Medicine","Engineering","Law",
"Literature","Business","Research"
];

const moodMap={
Sad:["sad","melancholy"],
Happy:["happiness","joy"],
Motivated:["motivation","self help"],
Romantic:["romance","love"],
Focused:["focus","deep work"],
Academic:["textbook","research"]
};

subjects.forEach(s=>{
let opt=document.createElement("option");
opt.value=s;
opt.textContent=s;
document.getElementById("advSubject").appendChild(opt);
});

Object.keys(moodMap).forEach(m=>{
let opt=document.createElement("option");
opt.value=m;
opt.textContent=m;
document.getElementById("moodSelect").appendChild(opt);
});

async function multiSearch(query,loadMore=false){

if(!query)return;

if(!loadMore){
startIndex=0;
currentQuery=query;
document.getElementById("results").innerHTML="Loading...";
document.getElementById("loadMoreContainer").innerHTML="";
}

try{

const googleURL=`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=${RESULTS_PER_PAGE}&startIndex=${startIndex}&key=${API_KEY}`;
const openURL=`https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&limit=${RESULTS_PER_PAGE}&offset=${startIndex}`;
const gutenURL=`https://gutendex.com/books/?search=${encodeURIComponent(query)}&page=${Math.floor(startIndex/RESULTS_PER_PAGE)+1}`;

const [g,o,u]=await Promise.all([
fetch(googleURL).then(r=>r.json()),
fetch(openURL).then(r=>r.json()),
fetch(gutenURL).then(r=>r.json())
]);

let books=[];

/* Google */
if(g.items){
g.items.forEach(item=>{
let v=item.volumeInfo;
books.push({
title:v.title,
author:v.authors?v.authors.join(", "):"Unknown",
year:v.publishedDate||"",
image:v.imageLinks?v.imageLinks.thumbnail:"",
link:v.previewLink||"#",
source:"Google Books"
});
});
}

/* Open Library */
if(o.docs){
o.docs.forEach(b=>{
books.push({
title:b.title,
author:b.author_name?b.author_name.join(", "):"Unknown",
year:b.first_publish_year||"",
image:b.cover_i?`https://covers.openlibrary.org/b/id/${b.cover_i}-M.jpg`:"",
link:`https://openlibrary.org${b.key}`,
source:"Open Library"
});
});
}

/* Gutenberg */
if(u.results){
u.results.forEach(b=>{
books.push({
title:b.title,
author:b.authors.map(a=>a.name).join(", "),
year:"Public Domain",
image:b.formats["image/jpeg"]||"",
link:b.formats["text/html"]||"#",
source:"Project Gutenberg"
});
});
}

/* Remove duplicates */
let unique=[];
let titles=new Set();
books.forEach(b=>{
if(!titles.has(b.title)){
titles.add(b.title);
unique.push(b);
}
});

if(!loadMore)
document.getElementById("results").innerHTML="";

unique.forEach(b=>{
let card=document.createElement("div");
card.className="book-card";
card.innerHTML=`
<div class="source-label">${b.source}</div>
<h3>${b.title||"No Title"}</h3>
<div class="meta"><strong>Author:</strong> ${b.author}</div>
<div class="meta"><strong>Published:</strong> ${b.year}</div>
${b.image?`<img src="${b.image}">`:""}
<a href="${b.link}" target="_blank"
style="display:inline-block;background:#0a2540;color:white;padding:8px 12px;border-radius:6px;text-decoration:none;margin-top:8px">
View Book
</a>
`;
document.getElementById("results").appendChild(card);
});

startIndex+=RESULTS_PER_PAGE;
addLoadMore();

}catch(err){
document.getElementById("results").innerHTML="Error loading books.";
}
}

function addLoadMore(){
let btn=document.createElement("button");
btn.textContent="Load More";
btn.style.padding="10px 18px";
btn.style.background="#0a2540";
btn.style.color="white";
btn.style.border="none";
btn.style.borderRadius="8px";
btn.onclick=()=>multiSearch(currentQuery,true);
document.getElementById("loadMoreContainer").innerHTML="";
document.getElementById("loadMoreContainer").appendChild(btn);
}

document.getElementById("advSearchBtn").onclick=function(){
let custom=document.getElementById("advCustomSubject").value.trim();
let subject=document.getElementById("advSubject").value;
multiSearch(custom?custom:subject);
};

document.getElementById("moodSearchBtn").onclick=function(){
let custom=document.getElementById("moodCustom").value.trim();
let mood=document.getElementById("moodSelect").value;
let query=custom?custom:(moodMap[mood]?moodMap[mood].join(" OR "):mood);
multiSearch(query);
};

</script>

</body>
</html>